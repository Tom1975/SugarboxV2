name: Release

on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10

jobs:
  call-workflow-windows:
    uses:  ./.github/workflows/build_windows.yml
  call-workflow-ubuntu:
    uses:  ./.github/workflows/build_ubuntu.yml
  call-workflow-macos:
    uses:  ./.github/workflows/build_macos.yml
    
  deploy:
    runs-on: ubuntu-latest
    needs: [all-workflow-windows, call-workflow-ubuntu, call-workflow-macos]
    steps:
      - name: Download artifact Ubuntu
        uses: actions/download-artifact@v3
        id: art-ubuntu
        with:
          name: SugarboxV2Ubuntu
          
      - name: Download artifact Windows
        uses: actions/download-artifact@v3
        id: art-windows
        with:
          name: SugarboxV2Win32
          
      - name: Download artifact MacOS
        uses: actions/download-artifact@v3
        id: art-macos
        with:
          name: SugarboxV2MacOS

      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            - ${{steps.art-ubuntu.outputs.download-path}}
            - ${{steps.art-windows.outputs.download-path}}
            - ${{steps.art-macos.outputs.download-path}}
            
          
